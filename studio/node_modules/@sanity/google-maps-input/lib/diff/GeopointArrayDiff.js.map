{"version":3,"file":"GeopointArrayDiff.js","names":["GeopointArrayDiff","diff","schemaType","api","GeopointDiff","fromValue","filter","hasCoordinates","toValue","length","bounds","getBounds","getCenter","toJSON","map","items","toIndex","pointDiff","isChangeDiff","action","type","point","lat","lng","LatLngBounds","points","forEach","extend"],"sources":["../../src/diff/GeopointArrayDiff.tsx"],"sourcesContent":["import * as React from 'react'\nimport {\n  ArrayDiff,\n  ObjectDiff,\n  Diff,\n  DiffProps as GenericDiffProps,\n  DiffComponent,\n} from '@sanity/field/diff'\nimport {GoogleMapsLoadProxy} from '../loader/GoogleMapsLoadProxy'\nimport {GoogleMap} from '../map/Map'\nimport {Geopoint} from '../types'\nimport {GeopointMove} from './GeopointMove'\nimport {RootContainer} from './GeopointFieldDiff.styles'\n\nexport type DiffProps = GenericDiffProps<ArrayDiff<Geopoint>>\n\nexport const GeopointArrayDiff: DiffComponent<ArrayDiff<Geopoint>> = ({diff, schemaType}) => {\n  return (\n    <RootContainer>\n      <GoogleMapsLoadProxy>\n        {(api) => <GeopointDiff api={api} diff={diff} schemaType={schemaType} />}\n      </GoogleMapsLoadProxy>\n    </RootContainer>\n  )\n}\n\nfunction GeopointDiff({api, diff}: DiffProps & {api: typeof window.google.maps}) {\n  const fromValue = (diff.fromValue || []).filter(hasCoordinates)\n  const toValue = (diff.toValue || []).filter(hasCoordinates)\n  if (fromValue.length === 0 && toValue.length === 0) {\n    return null\n  }\n\n  const bounds = getBounds(fromValue, toValue, api)\n  return (\n    <GoogleMap\n      api={api}\n      location={bounds.getCenter().toJSON()}\n      mapTypeControl={false}\n      controlSize={20}\n      bounds={bounds}\n    >\n      {(map) => (\n        <>\n          {diff.items.map(({toIndex, diff: pointDiff}) => {\n            if (!isChangeDiff(pointDiff)) {\n              return null\n            }\n\n            return (\n              <GeopointMove\n                key={toIndex}\n                api={api}\n                map={map}\n                diff={pointDiff}\n                label={`${toIndex}`}\n              />\n            )\n          })}\n        </>\n      )}\n    </GoogleMap>\n  )\n}\n\nfunction isChangeDiff(diff: Diff): diff is ObjectDiff<Geopoint> {\n  return diff.action !== 'unchanged' && diff.type === 'object'\n}\n\nfunction hasCoordinates(point: Partial<Geopoint>): point is Geopoint {\n  return typeof point.lat === 'number' && typeof point.lng === 'number'\n}\n\nfunction getBounds(\n  fromValue: google.maps.LatLngLiteral[] | null | undefined,\n  toValue: google.maps.LatLngLiteral[] | null | undefined,\n  api: typeof window.google.maps\n): google.maps.LatLngBounds {\n  const bounds = new api.LatLngBounds()\n  const points = [...(fromValue || []), ...(toValue || [])]\n  points.forEach((point) => bounds.extend(point))\n  return bounds\n}\n"],"mappings":";;;;;;AAAA;AAQA;AACA;AAEA;AACA;AAAwD;AAAA;AAIjD,IAAMA,iBAAqD,GAAG,QAAwB;EAAA,IAAtBC,IAAI,QAAJA,IAAI;IAAEC,UAAU,QAAVA,UAAU;EACrF,oBACE,oBAAC,gCAAa,qBACZ,oBAAC,wCAAmB,QAChBC,GAAG,iBAAK,oBAAC,YAAY;IAAC,GAAG,EAAEA,GAAI;IAAC,IAAI,EAAEF,IAAK;IAAC,UAAU,EAAEC;EAAW,EAAG,CACpD,CACR;AAEpB,CAAC;AAAA;AAED,SAASE,YAAY,QAA4D;EAAA,IAA1DD,GAAG,SAAHA,GAAG;IAAEF,IAAI,SAAJA,IAAI;EAC9B,IAAMI,SAAS,GAAG,CAACJ,IAAI,CAACI,SAAS,IAAI,EAAE,EAAEC,MAAM,CAACC,cAAc,CAAC;EAC/D,IAAMC,OAAO,GAAG,CAACP,IAAI,CAACO,OAAO,IAAI,EAAE,EAAEF,MAAM,CAACC,cAAc,CAAC;EAC3D,IAAIF,SAAS,CAACI,MAAM,KAAK,CAAC,IAAID,OAAO,CAACC,MAAM,KAAK,CAAC,EAAE;IAClD,OAAO,IAAI;EACb;EAEA,IAAMC,MAAM,GAAGC,SAAS,CAACN,SAAS,EAAEG,OAAO,EAAEL,GAAG,CAAC;EACjD,oBACE,oBAAC,cAAS;IACR,GAAG,EAAEA,GAAI;IACT,QAAQ,EAAEO,MAAM,CAACE,SAAS,EAAE,CAACC,MAAM,EAAG;IACtC,cAAc,EAAE,KAAM;IACtB,WAAW,EAAE,EAAG;IAChB,MAAM,EAAEH;EAAO,GAEbI,GAAG,iBACH,0CACGb,IAAI,CAACc,KAAK,CAACD,GAAG,CAAC,SAAgC;IAAA,IAA9BE,OAAO,SAAPA,OAAO;MAAQC,SAAS,SAAfhB,IAAI;IAC7B,IAAI,CAACiB,YAAY,CAACD,SAAS,CAAC,EAAE;MAC5B,OAAO,IAAI;IACb;IAEA,oBACE,oBAAC,0BAAY;MACX,GAAG,EAAED,OAAQ;MACb,GAAG,EAAEb,GAAI;MACT,GAAG,EAAEW,GAAI;MACT,IAAI,EAAEG,SAAU;MAChB,KAAK,YAAKD,OAAO;IAAG,EACpB;EAEN,CAAC,CAAC,CAEL,CACS;AAEhB;AAEA,SAASE,YAAY,CAACjB,IAAU,EAAgC;EAC9D,OAAOA,IAAI,CAACkB,MAAM,KAAK,WAAW,IAAIlB,IAAI,CAACmB,IAAI,KAAK,QAAQ;AAC9D;AAEA,SAASb,cAAc,CAACc,KAAwB,EAAqB;EACnE,OAAO,OAAOA,KAAK,CAACC,GAAG,KAAK,QAAQ,IAAI,OAAOD,KAAK,CAACE,GAAG,KAAK,QAAQ;AACvE;AAEA,SAASZ,SAAS,CAChBN,SAAyD,EACzDG,OAAuD,EACvDL,GAA8B,EACJ;EAC1B,IAAMO,MAAM,GAAG,IAAIP,GAAG,CAACqB,YAAY,EAAE;EACrC,IAAMC,MAAM,GAAG,CAAC,IAAIpB,SAAS,IAAI,EAAE,CAAC,EAAE,IAAIG,OAAO,IAAI,EAAE,CAAC,CAAC;EACzDiB,MAAM,CAACC,OAAO,CAAEL,KAAK,IAAKX,MAAM,CAACiB,MAAM,CAACN,KAAK,CAAC,CAAC;EAC/C,OAAOX,MAAM;AACf"}