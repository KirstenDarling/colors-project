{"version":3,"file":"loadGoogleMapsApi.js","names":["callbackName","authFailureCallbackName","locale","window","navigator","language","subject","loadGoogleMapsApi","selectedLocale","config","defaultLocale","BehaviorSubject","loadState","next","api","google","maps","script","document","createElement","onerror","event","source","lineno","colno","error","coeerceError","src","apiKey","getElementsByTagName","appendChild","Error","isErrorEvent","message"],"sources":["../../src/loader/loadGoogleMapsApi.ts"],"sourcesContent":["// @todo: remove the following line when part imports has been removed from this file\n///<reference types=\"@sanity/types/parts\" />\n\nimport {Observable, BehaviorSubject} from 'rxjs'\nimport config from 'config:@sanity/google-maps-input'\n\nconst callbackName = '___sanity_googleMapsApiCallback'\nconst authFailureCallbackName = 'gm_authFailure'\nconst locale = (typeof window !== 'undefined' && window.navigator.language) || 'en'\n\nexport interface LoadingState {\n  loadState: 'loading'\n}\n\nexport interface LoadedState {\n  loadState: 'loaded'\n  api: typeof window.google.maps\n}\n\nexport interface LoadErrorState {\n  loadState: 'loadError'\n  error: Error\n}\n\nexport interface AuthErrorState {\n  loadState: 'authError'\n}\n\nexport type GoogleLoadState = LoadingState | LoadedState | LoadErrorState | AuthErrorState\n\nlet subject: BehaviorSubject<GoogleLoadState>\n\nexport function loadGoogleMapsApi(): Observable<GoogleLoadState> {\n  const selectedLocale = config.defaultLocale || locale || 'en-US'\n\n  if (subject) {\n    return subject\n  }\n\n  subject = new BehaviorSubject<GoogleLoadState>({loadState: 'loading'})\n\n  window[authFailureCallbackName] = () => {\n    delete window[authFailureCallbackName]\n    subject.next({loadState: 'authError'})\n  }\n\n  window[callbackName] = () => {\n    delete window[callbackName]\n    subject.next({loadState: 'loaded', api: window.google.maps})\n  }\n\n  const script = document.createElement('script')\n  script.onerror = (\n    event: Event | string,\n    source?: string,\n    lineno?: number,\n    colno?: number,\n    error?: Error\n  ) =>\n    subject.next({\n      loadState: 'loadError',\n      error: coeerceError(event, error),\n    } as LoadErrorState)\n\n  script.src = `https://maps.googleapis.com/maps/api/js?key=${config.apiKey}&libraries=places&callback=${callbackName}&language=${selectedLocale}`\n  document.getElementsByTagName('head')[0].appendChild(script)\n\n  return subject\n}\n\nfunction coeerceError(event: Event | string, error?: Error): Error {\n  if (error) {\n    return error\n  }\n\n  if (typeof event === 'string') {\n    return new Error(event)\n  }\n\n  return new Error(isErrorEvent(event) ? event.message : 'Failed to load Google Maps API')\n}\n\nfunction isErrorEvent(event: unknown): event is ErrorEvent {\n  if (typeof event !== 'object' || event === null) {\n    return false\n  }\n\n  if (!('message' in event)) {\n    return false\n  }\n\n  return typeof (event as ErrorEvent).message === 'string'\n}\n"],"mappings":";;;;;;AAGA;AACA;AAAqD;AAJrD;AACA;;AAKA,IAAMA,YAAY,GAAG,iCAAiC;AACtD,IAAMC,uBAAuB,GAAG,gBAAgB;AAChD,IAAMC,MAAM,GAAI,OAAOC,MAAM,KAAK,WAAW,IAAIA,MAAM,CAACC,SAAS,CAACC,QAAQ,IAAK,IAAI;AAsBnF,IAAIC,OAAyC;AAEtC,SAASC,iBAAiB,GAAgC;EAC/D,IAAMC,cAAc,GAAGC,wBAAM,CAACC,aAAa,IAAIR,MAAM,IAAI,OAAO;EAEhE,IAAII,OAAO,EAAE;IACX,OAAOA,OAAO;EAChB;EAEAA,OAAO,GAAG,IAAIK,qBAAe,CAAkB;IAACC,SAAS,EAAE;EAAS,CAAC,CAAC;EAEtET,MAAM,CAACF,uBAAuB,CAAC,GAAG,MAAM;IACtC,OAAOE,MAAM,CAACF,uBAAuB,CAAC;IACtCK,OAAO,CAACO,IAAI,CAAC;MAACD,SAAS,EAAE;IAAW,CAAC,CAAC;EACxC,CAAC;EAEDT,MAAM,CAACH,YAAY,CAAC,GAAG,MAAM;IAC3B,OAAOG,MAAM,CAACH,YAAY,CAAC;IAC3BM,OAAO,CAACO,IAAI,CAAC;MAACD,SAAS,EAAE,QAAQ;MAAEE,GAAG,EAAEX,MAAM,CAACY,MAAM,CAACC;IAAI,CAAC,CAAC;EAC9D,CAAC;EAED,IAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;EAC/CF,MAAM,CAACG,OAAO,GAAG,CACfC,KAAqB,EACrBC,MAAe,EACfC,MAAe,EACfC,KAAc,EACdC,KAAa,KAEbnB,OAAO,CAACO,IAAI,CAAC;IACXD,SAAS,EAAE,WAAW;IACtBa,KAAK,EAAEC,YAAY,CAACL,KAAK,EAAEI,KAAK;EAClC,CAAC,CAAmB;EAEtBR,MAAM,CAACU,GAAG,yDAAkDlB,wBAAM,CAACmB,MAAM,wCAA8B5B,YAAY,uBAAaQ,cAAc,CAAE;EAChJU,QAAQ,CAACW,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAACC,WAAW,CAACb,MAAM,CAAC;EAE5D,OAAOX,OAAO;AAChB;AAEA,SAASoB,YAAY,CAACL,KAAqB,EAAEI,KAAa,EAAS;EACjE,IAAIA,KAAK,EAAE;IACT,OAAOA,KAAK;EACd;EAEA,IAAI,OAAOJ,KAAK,KAAK,QAAQ,EAAE;IAC7B,OAAO,IAAIU,KAAK,CAACV,KAAK,CAAC;EACzB;EAEA,OAAO,IAAIU,KAAK,CAACC,YAAY,CAACX,KAAK,CAAC,GAAGA,KAAK,CAACY,OAAO,GAAG,gCAAgC,CAAC;AAC1F;AAEA,SAASD,YAAY,CAACX,KAAc,EAAuB;EACzD,IAAI,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,EAAE;IAC/C,OAAO,KAAK;EACd;EAEA,IAAI,EAAE,SAAS,IAAIA,KAAK,CAAC,EAAE;IACzB,OAAO,KAAK;EACd;EAEA,OAAO,OAAQA,KAAK,CAAgBY,OAAO,KAAK,QAAQ;AAC1D"}