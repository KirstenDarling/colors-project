{"version":3,"file":"GeopointFieldDiff.js","names":["GeopointFieldDiff","diff","schemaType","api","GeopointDiff","fromValue","toValue","annotation","getAnnotationAtPath","center","getCenter","bounds","getBounds","undefined","getAction","map","LatLngBounds","extend","toJSON","Error"],"sources":["../../src/diff/GeopointFieldDiff.tsx"],"sourcesContent":["import * as React from 'react'\nimport {\n  DiffComponent,\n  ObjectDiff,\n  DiffProps as GenericDiffProps,\n  DiffTooltip,\n  getAnnotationAtPath,\n} from '@sanity/field/diff'\nimport {GoogleMapsLoadProxy} from '../loader/GoogleMapsLoadProxy'\nimport {GoogleMap} from '../map/Map'\nimport {Geopoint} from '../types'\nimport {GeopointMove} from './GeopointMove'\nimport {RootContainer} from './GeopointFieldDiff.styles'\n\nexport type DiffProps = GenericDiffProps<ObjectDiff<Geopoint>>\n\nexport const GeopointFieldDiff: DiffComponent<ObjectDiff<Geopoint>> = ({diff, schemaType}) => {\n  return (\n    <RootContainer>\n      <GoogleMapsLoadProxy>\n        {(api) => <GeopointDiff api={api} diff={diff} schemaType={schemaType} />}\n      </GoogleMapsLoadProxy>\n    </RootContainer>\n  )\n}\n\nfunction GeopointDiff({api, diff}: DiffProps & {api: typeof window.google.maps}) {\n  const {fromValue, toValue} = diff\n  const annotation =\n    getAnnotationAtPath(diff, ['lat']) ||\n    getAnnotationAtPath(diff, ['lng']) ||\n    getAnnotationAtPath(diff, [])\n\n  const center = getCenter(diff, api)\n  const bounds = fromValue && toValue ? getBounds(fromValue, toValue, api) : undefined\n\n  return (\n    <DiffTooltip annotations={annotation ? [annotation] : []} description={getAction(diff)}>\n      <div>\n        <GoogleMap\n          api={api}\n          location={center}\n          mapTypeControl={false}\n          controlSize={20}\n          bounds={bounds}\n          scrollWheel={false}\n        >\n          {(map) => <GeopointMove api={api} map={map} diff={diff} />}\n        </GoogleMap>\n      </div>\n    </DiffTooltip>\n  )\n}\n\nfunction getBounds(\n  fromValue: google.maps.LatLngLiteral,\n  toValue: google.maps.LatLngLiteral,\n  api: typeof window.google.maps\n): google.maps.LatLngBounds {\n  return new api.LatLngBounds().extend(fromValue).extend(toValue)\n}\n\nfunction getCenter(\n  diff: DiffProps['diff'],\n  api: typeof window.google.maps\n): google.maps.LatLngLiteral {\n  const {fromValue, toValue} = diff\n  if (fromValue && toValue) {\n    return getBounds(fromValue, toValue, api).getCenter().toJSON()\n  }\n\n  if (fromValue) {\n    return fromValue\n  }\n\n  if (toValue) {\n    return toValue\n  }\n\n  throw new Error('Neither a from or a to value present')\n}\n\nfunction getAction(diff: ObjectDiff<Geopoint>) {\n  const {fromValue, toValue} = diff\n  if (fromValue && toValue) {\n    return 'Moved'\n  } else if (fromValue) {\n    return 'Removed'\n  } else if (toValue) {\n    return 'Added'\n  }\n\n  return 'Unchanged'\n}\n"],"mappings":";;;;;;AAAA;AACA;AAOA;AACA;AAEA;AACA;AAAwD;AAAA;AAIjD,IAAMA,iBAAsD,GAAG,QAAwB;EAAA,IAAtBC,IAAI,QAAJA,IAAI;IAAEC,UAAU,QAAVA,UAAU;EACtF,oBACE,oBAAC,gCAAa,qBACZ,oBAAC,wCAAmB,QAChBC,GAAG,iBAAK,oBAAC,YAAY;IAAC,GAAG,EAAEA,GAAI;IAAC,IAAI,EAAEF,IAAK;IAAC,UAAU,EAAEC;EAAW,EAAG,CACpD,CACR;AAEpB,CAAC;AAAA;AAED,SAASE,YAAY,QAA4D;EAAA,IAA1DD,GAAG,SAAHA,GAAG;IAAEF,IAAI,SAAJA,IAAI;EAC9B,IAAOI,SAAS,GAAaJ,IAAI,CAA1BI,SAAS;IAAEC,OAAO,GAAIL,IAAI,CAAfK,OAAO;EACzB,IAAMC,UAAU,GACd,IAAAC,yBAAmB,EAACP,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,IAClC,IAAAO,yBAAmB,EAACP,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,IAClC,IAAAO,yBAAmB,EAACP,IAAI,EAAE,EAAE,CAAC;EAE/B,IAAMQ,MAAM,GAAGC,SAAS,CAACT,IAAI,EAAEE,GAAG,CAAC;EACnC,IAAMQ,MAAM,GAAGN,SAAS,IAAIC,OAAO,GAAGM,SAAS,CAACP,SAAS,EAAEC,OAAO,EAAEH,GAAG,CAAC,GAAGU,SAAS;EAEpF,oBACE,oBAAC,iBAAW;IAAC,WAAW,EAAEN,UAAU,GAAG,CAACA,UAAU,CAAC,GAAG,EAAG;IAAC,WAAW,EAAEO,SAAS,CAACb,IAAI;EAAE,gBACrF,8CACE,oBAAC,cAAS;IACR,GAAG,EAAEE,GAAI;IACT,QAAQ,EAAEM,MAAO;IACjB,cAAc,EAAE,KAAM;IACtB,WAAW,EAAE,EAAG;IAChB,MAAM,EAAEE,MAAO;IACf,WAAW,EAAE;EAAM,GAEjBI,GAAG,iBAAK,oBAAC,0BAAY;IAAC,GAAG,EAAEZ,GAAI;IAAC,GAAG,EAAEY,GAAI;IAAC,IAAI,EAAEd;EAAK,EAAG,CAChD,CACR,CACM;AAElB;AAEA,SAASW,SAAS,CAChBP,SAAoC,EACpCC,OAAkC,EAClCH,GAA8B,EACJ;EAC1B,OAAO,IAAIA,GAAG,CAACa,YAAY,EAAE,CAACC,MAAM,CAACZ,SAAS,CAAC,CAACY,MAAM,CAACX,OAAO,CAAC;AACjE;AAEA,SAASI,SAAS,CAChBT,IAAuB,EACvBE,GAA8B,EACH;EAC3B,IAAOE,SAAS,GAAaJ,IAAI,CAA1BI,SAAS;IAAEC,OAAO,GAAIL,IAAI,CAAfK,OAAO;EACzB,IAAID,SAAS,IAAIC,OAAO,EAAE;IACxB,OAAOM,SAAS,CAACP,SAAS,EAAEC,OAAO,EAAEH,GAAG,CAAC,CAACO,SAAS,EAAE,CAACQ,MAAM,EAAE;EAChE;EAEA,IAAIb,SAAS,EAAE;IACb,OAAOA,SAAS;EAClB;EAEA,IAAIC,OAAO,EAAE;IACX,OAAOA,OAAO;EAChB;EAEA,MAAM,IAAIa,KAAK,CAAC,sCAAsC,CAAC;AACzD;AAEA,SAASL,SAAS,CAACb,IAA0B,EAAE;EAC7C,IAAOI,SAAS,GAAaJ,IAAI,CAA1BI,SAAS;IAAEC,OAAO,GAAIL,IAAI,CAAfK,OAAO;EACzB,IAAID,SAAS,IAAIC,OAAO,EAAE;IACxB,OAAO,OAAO;EAChB,CAAC,MAAM,IAAID,SAAS,EAAE;IACpB,OAAO,SAAS;EAClB,CAAC,MAAM,IAAIC,OAAO,EAAE;IAClB,OAAO,OAAO;EAChB;EAEA,OAAO,WAAW;AACpB"}